## June 8

I would like to gradually replace all of the Google apps that I use to manage my personal data. While I'm at it, I'd like to combine all of the productivity apps that I use into one single app, a kind of super-notes app I'm calling **cards** at the moment.

Step #1, learn more about [Sandstorm](https://sandstorm.io/). At the moment I use Sandstorm to host [Tiny Tiny RSS](https://tt-rss.org/) and a few other 3rd party self-host experiments. I'd like to use it for my own apps as well.

Time to read the [docs](https://docs.sandstorm.io/en/latest/)!

Some intital questions:
 1. how do sandboxed apps (grains) become active?
   - it seems like they're inactive until opened in the UI but then how does my tt-rss app talk to the server for updates?
 2. how do I wrap a clojure app?

To setup an app, Sandstorm uses several shell scripts that run a different points. To wrap a clojure app I'll need to add things to those scripts.

### setup.sh

This seems to be where I put my *platform* setup code. It runs once when I run `vagrant-spk vm up`. My app is an [Edge] Clojure app which uses `clj`. The clojure docs say to install bash, curl, rlwrap, and Java then run:

```
curl -O https://download.clojure.org/install/linux-install-1.10.1.447.sh
chmod +x linux-install-1.10.1.447.sh
sudo ./linux-install-1.10.1.447.sh
```

After editing `setup.sh` I need to run `vagrant-spk vm provision`. To confirm it works I can also run `vagrant-spk vm destroy` then `vagrant-spk vm up`.

### build.sh

This looks like where I put my *app* setup code. It runs each time I run `vagrant-spk dev`. Presumably this is where I'll start the app using a dev profile. How do I access the REPL from within Sandstorm?

Or is this where I build an uberjar?

### launcher.sh

This looks like where I put code that runs each time a user opens the app.  I signal that the app is ready by listening on port 8000 for HTTP requests.

When running my app `/var` is the only directory that persists between loads.

### now what?

My biggest question at this point is: should I just build an uberjar outside of Sandstorm as part of my `clj` workflow?

Lets try that first. First I build an uberjar in the project root, then add these:

```sh
;; setup.sh
export DEBIAN_FRONTEND=noninteractive
apt-get update
apt-get install -y default-jre
exit 0

;; launcher.sh
cd /opt/app
java -jar bontu.jar
exit 0
```

Doesn't work :( Trying to launch a new grain gives "The connection to the server was reset while the page was loading.".

Testing the `bontu.jar` outside of Sandstorm and it doesn't work anyway, there's the problem. Something is wrong with the uberjar building process. I think it was a mistake trying to get Sandstorm working with a brand new Edge app that I don't fully understand yet.
